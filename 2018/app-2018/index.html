<!DOCTYPE html>
<html>

<head>

  <link rel="stylesheet" href="reset.css">
  <link rel="stylesheet" href="main.css">

  <link rel="preload" href="images/kresge_background.jpg" as="image">
  <link rel="preload" href="images/black_background.png" as="image">

  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' />

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
  <!--
    TODO: Add FB and Meta Tags
    TODO: Add Favicon and other icons
  -->

  <!--

  <link rel="preload" href="images/danger.png" as="image">

  <link rel="preload" href="images/silver.png" as="image">
  <link rel="preload" href="images/red.png" as="image">
  <link rel="preload" href="images/orange.png" as="image">
  <link rel="preload" href="images/yellow.png" as="image">
  <link rel="preload" href="images/green.png" as="image">
  <link rel="preload" href="images/blue.png" as="image">
  <link rel="preload" href="images/purple.png" as="image">
  <link rel="preload" href="images/pink.png" as="image">
-->
</head>

<body>
  <div class="background">
    <div id="photo_background">
      <div id="black_background">
      </div>
    </div>
  </div>
  <div class="presentation-info">
    <p>Monday, December 10 &middot; Kresge 7:30PM</p>
  </div>

  <div class="content">
    <div class="centering-container">
      <img class="tr knife-image blue-knife" src="images/svg/blue-knife.svg" />
      <img class="tl knife-image red-knife" src="images/svg/red-knife.svg" />
      <img class="bl knife-image orange-knife" src="images/svg/orange-knife.svg" />
      <img class="br knife-image yellow-knife" src="images/svg/yellow-knife.svg" />
      <img class="tl knife-image green-knife" src="images/svg/green-knife.svg" />
      <img class="tr knife-image silver-knife" src="images/svg/silver-knife.svg" />
      <img class="br knife-image pink-knife" src="images/svg/pink-knife.svg" />
      <img class="bl knife-image purple-knife" src="images/svg/purple-knife.svg" />
      <div class="danger-subtitle">
        2.009 Product Launch
      </div>
      <div class="jiggly-container">
        <div class="danger-logo">
        </div>
      </div>
      <div class="danger-logo-dust">
      </div>
    </div>
  </div>
  <div class="button-container">
    <a id="rsvp-btn" class=".rsvp-btn" href="https://2009.mit.edu/apps/rsvp/new_guest/">Click
      to
      RSVP</a>
  </div>
</body>
<script type="text/javascript">
  // I am full of knives 
  // Knife knife knifety knife
  // k
  // n
  // i 
  // f
  // e

  // OK SO FUN FACT
  // if you change this speed to 700, it becomes a LOT more uncomfortable for some reason
  var knivesRetractionSpeed = 300;

  // For parsing the URLs
  var urlP = 'none';
  function parseQueryString(url) {
    var urlParams = {};
    url.replace(new RegExp("([^?=&]+)(=([^&]*))?", "g"),
      function ($0, $1, $2, $3) {
        urlParams[$1] = $3;
      });
    return urlParams;
  }

  function setRSVPUrl() {
    var urlParams = parseQueryString(location.search);
    if (urlParams['invite'] != undefined) {
      urlP = urlParams['invite'];
      document.getElementById("rsvp-btn").href = 'https://2009.mit.edu/apps/rsvp/login/' + urlParams['invite'];
    } else {
      $('.rsvp-btn').text('Ticket System')
    }

    // Clears the url to a blank state incase they want to share the URL
    // Elaine, do you remember why this was commented out? - Victor, Nov 27, 2018 3:41am
    // window.history.replaceState({}, document.title, "/");
  }

  function getPositionByExtendedOutAmount($this, extendOutBy) {

    w = $this.width();
    h = $this.height();
    x = $this.offset().left;
    y = $this.offset().top;

    if ($this.hasClass('tl')) {
      theta = Math.atan(h / w);
      if (Math.tan(theta) * x < y) {
        // enter from left of page
        intersectAt = y - x * Math.tan(theta)
        l = -w + Math.cos(theta) * extendOutBy
        t = intersectAt - h + verticalOffset + Math.sin(theta) * extendOutBy
      } else {
        // enter from top of page
        intersectAt = x - y / Math.tan(theta)
        l = intersectAt - w + Math.cos(theta) * extendOutBy
        t = -h + verticalOffset + Math.sin(theta) * extendOutBy
      }

    } else if ($this.hasClass('bl')) {

      theta = Math.atan(h / w);
      if (Math.tan(theta) * x > dh - (y + h)) {
        // enter from bottom of page
        intersectAt = x - (dh - y) / Math.tan(theta)
        l = intersectAt
        t = dh + verticalOffset - Math.sin(theta) * extendOutBy
      } else {
        // enter from left of page
        intersectAt = y + h + x * Math.tan(theta)
        l = -w + Math.cos(theta) * extendOutBy
        t = intersectAt + verticalOffset - Math.sin(theta) * extendOutBy
      }
    } else if ($this.hasClass('tr')) {

      theta = Math.atan(h / w);
      if (Math.tan(theta) * x > dh - (y + h)) {
        // enter from top of page
        intersectAt = dw - (x - (dh - y) / Math.tan(theta))
        l = intersectAt - w
        t = -h + verticalOffset + Math.sin(theta) * extendOutBy
      } else {
        // enter from right of page
        intersectAt = y - (dw - (x + w)) * Math.tan(theta)
        l = dw - Math.cos(theta) * extendOutBy
        t = intersectAt - h + verticalOffset + Math.sin(theta) * extendOutBy
      }

    } else if ($this.hasClass('br')) {
      theta = Math.atan(h / w);
      if (Math.tan(theta) * x < y) {
        // enter from right of page
        intersectAt = y + h + (dw - x - w) * Math.tan(theta)
        l = dw - Math.cos(theta) * extendOutBy
        t = intersectAt + verticalOffset - Math.sin(theta) * extendOutBy

        // } else {
        //
        // enter from bottom of page
        /*
        // so, unless your screen is SUPER flat
        // like a hot dog
        // you should never hit this case
        // I don't actually want to think through this
        // so I'm just going to leave you this message

        intersectAt = x - y / Math.tan(theta)
        l = intersectAt - w + Math.cos(theta) * extendOutBy
        t = -h + verticalOffset + Math.sin(theta) * extendOutBy
        */
      }

    }
    return [l, t];
  }

  $(window).resize(function () {
    // resizing ruins everything. Just going to disable everything if you attempt to resize mid-animation

    $('.knife-image').each(function () {
      $(this).attr('style', '');
      $(this).css(
        "opacity", 0.8);
      $(this).stop();
    });
    mouseEnabled = false;
  });


  // Init Function
  function init() {

    setTimeout(function () {
      $('.jiggly-container').addClass('rotate-jiggle');
      setTimeout(function () {
        $('.jiggly-container').removeClass('rotate-jiggle');
      }, 100);
    }, 2900);

    $('.knife-image').each(function () {
      // did you know that the proportions of a bounding rectangular box is roughly the angle the knife should be coming in at? wow!
      $this = $(this);

      verticalOffset = 100;
      dw = $(window).width();
      dh = $(window).height();

      w = $this.width();
      h = $this.height();
      x = $this.offset().left;
      y = $this.offset().top;

      theta = Math.atan(h / w)
      jiggle = 40;

      if (dw < 500) {
        // small screens or mobile
        pokeySharpBit = 50;
      } else {
        pokeySharpBit = 150;
      }

      [l1, t1] = getPositionByExtendedOutAmount($this, -70);
      [l2, t2] = getPositionByExtendedOutAmount($this, pokeySharpBit);

      // Animation stack don't look gross
      $(this).animate({
        left: l1,
        top: t1
      }, 100)
        .delay(1000)
        .animate({
          left: l2,
          top: t2,
          opacity: 0.8,
        }, 300)
        .delay(1000)
        .animate({
          left: x,
          top: y + verticalOffset
        }, { duration: 400, easing: 'easeInQuad' });


      // JIGGLE on mouse rollover
      jx = 0;
      jy = 0;

      if ($this.hasClass('tl')) {
        jy = Math.floor(Math.sin(theta) * jiggle)
        jx = Math.floor(Math.cos(theta) * jiggle)
      } else if ($this.hasClass('tr')) {
        jy = Math.floor(Math.sin(theta) * jiggle)
        jx = -Math.floor(Math.cos(theta) * jiggle)
      } else if ($this.hasClass('br')) {
        jy = -Math.floor(Math.sin(theta) * jiggle)
        jx = -Math.floor(Math.cos(theta) * jiggle)
      } else {
        jy = -Math.floor(Math.sin(theta) * jiggle)
        jx = Math.floor(Math.cos(theta) * jiggle)
      }

      setHovers($this, jx, jy, x, y + verticalOffset);
      mouseEnabled = false;
      setTimeout(function () {
        mouseEnabled = true
      }, 3000);

    });
  }

  // Jiggle here moved out
  function setHovers($this, jx, jy, l2, t2) {
    $this.on('mouseover', function () {
      if (mouseEnabled)
        $this.stop().animate({
          left: `+=${jx}px`,
          top: `+=${jy}px`
        }, 100)
    });

    $this.on('touchstart', function () {
      if (mouseEnabled)
        $this.stop().animate({
          left: `+=${jx}px`,
          top: `+=${jy}px`
        }, 100)
    });

    $this.on('mouseout', function () {
      if (mouseEnabled)
        $this.stop().animate({
          left: `${l2}px`,
          top: `${t2}px`
        }, knivesRetractionSpeed);
    })

    $this.on('touchend', function () {
      if (mouseEnabled)
        $this.stop().animate({
          left: `${l2}px`,
          top: `${t2}px`
        }, knivesRetractionSpeed);
    })
  }

  $(function () {
    setRSVPUrl();
    // This needs a 500ms delay to accomodate chrome rendering bug
    setTimeout(init, 500);
  })
</script>

</html>